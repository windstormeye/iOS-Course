> è¿™ä¸ªç»„ä»¶åšçš„å®åœ¨æ˜¯å¤ªä¹…äº†ï¼Œæœ€è¿‘ç»ˆäºä»ä¸€å¤§å †äº‹å„¿ä¸­æ…¢æ…¢çš„æ¢å¤è¿‡æ¥äº†ï¼Œç»§ç»­è‚ï¼

## å‰è¨€

è¿™æ¬¡çš„ç»„ä»¶å¼€å‘æ¢äº†ä¸ªæ€è·¯ç»§ç»­ç²¾è¿›ï¼Œä¹Ÿè¿˜æ˜¯ `MVC` çš„æ¨¡å¼ï¼Œå‰æ®µæ—¶é—´è‡ªå·±éå¸¸çº ç»“åˆ°åº•å“ªç§æ¨¡å¼æ‰æ˜¯â€œæœ€ä½³â€è®¾è®¡æ¨¡å¼ï¼Ÿç¿»é˜…äº†å¤§é‡èµ„æ–™ï¼Œåæ¥åœ¨[è¿™ç¯‡æ–‡ç« ](https://www.jianshu.com/p/33c7e2f3a613)ä¸­å¾—åˆ°äº†â€œæ•‘èµâ€ï¼Œè®©æˆ‘çœŸæ­£çš„ä»å›å½’åˆ°ä»å®é™…é—®é¢˜å‡ºå‘ï¼Œè€Œä¸æ˜¯ä¸€æ˜§çš„ä¸ºäº†â€œç”¨â€è€Œç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ˜¨å¤©çš„è¿­ä»£æ€»ç»“ä¼šä¸Šï¼Œandroid åŒå­¦â€œå¤¸å¤¸å…¶è°ˆâ€çš„åˆ—å‡ºäº†è®¸å¤šæ‰€è°“çš„â€œä¼˜åŒ–ç‚¹â€ï¼ŒæŸäº›â€œä¼˜åŒ–ç‚¹â€åœ¨æˆ‘çœ‹æ¥å´æ˜¯ååˆ†çš„å¯ç¬‘ï¼Œæœ¬æ¥ä»¥ä¸ºæ¥äº†ä¸ªå¤§ä½¬ï¼Œç°åœ¨çœ‹æ¥å´æ˜¯ä¸ªâ€œå¤§ä½¬â€ã€‚

ä» 11 æœˆæœ«å¼€å§‹å°±ç€æ‰‹å‡†å¤‡å¼€å‘è¿™ä¸€æ–°ç»„ä»¶ï¼Œä½†å› ä¸ºåˆšå¥½ä¸ä¸‰æ–¹ã€æ–°ç‰ˆæœ¬è¿­ä»£æœŸã€æœŸæœ«è¯¾è®¾ç­‰å„ç§å› ç´ å¯¼è‡´ç»„ä»¶å¼€å‘ä¸€å†å»¶åã€‚è¯¥ç»„ä»¶åˆ©ç”¨äº† `PhotosKit` æ¡†æ¶ï¼Œå®Œæˆäº†ä»ç³»ç»Ÿç›¸å†Œè¯»å–å¹¶è‡ªå®šä¹‰ç›¸å†Œçš„åŠŸèƒ½ï¼Œè®¾è®¡ç¨¿å¦‚ä¸‹ï¼›

![è®¾è®¡ç¨¿](https://i.loli.net/2018/12/21/5c1c9bade7ff8.png)


## æ€è€ƒ
ä¸€å¼€å§‹çœ‹åˆ°è®¾è®¡å›¾åï¼Œæ„Ÿè§‰å¹¶æ²¡æœ‰å¤šå°‘ä¸œè¥¿éœ€è¦å»åšï¼Œç©å¥½ `PhotosKit` å³å¯ï¼Œç»è¿‡äº†ä¸€æ®µæ—¶é—´åï¼Œå†ä¸‰ç¡®è®¤åï¼Œæœ€ç»ˆçš„äº§å“æ•ˆæœæ˜¯è¦å¯¹é½ `Instagram` é‡Œçš„â€œç…§ç‰‡æµè§ˆå™¨â€ä½“éªŒä¸€è‡´ï¼Œæˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![Instagram ç…§ç‰‡æµè§ˆå™¨æˆªå›¾](https://i.loli.net/2018/12/21/5c1c9d27849a2.png)

æ¥ç€æˆ‘å°±å»ç©äº† `Instagram`ï¼Œè¶Šç©è¶Šæ„Ÿè§‰è¿™æ˜¯ä¸ªâ€œå¤§å‘â€ï¼Œå¦‚æœè¦åšåˆ° 100% çš„äº¤äº’ç›¸ä¼¼ï¼Œä¼°è®¡åšå®Œç›´æ¥ä¸¢å‡ºå»å¼€æºåˆä¼šæ‹‰åˆ°ä¸€æ³¢ starï¼Œå¯¹ `Instagram` çš„â€ç…§ç‰‡æµè§ˆå™¨â€œåˆ†æå¦‚ä¸‹ï¼š

* å¯ä»¥ç®€å•çš„è¿›è¡Œä¸Šä¸‹æ‹†åˆ†ã€‚ä¸Šéƒ¨åˆ†ä¸ºâ€é€‰ä¸­è§†å›¾â€œï¼Œå¯ä»¥ç›´æ¥å¥— `UIImageView`ï¼Œä¸‹éƒ¨åˆ†ä¸ºâ€œæµè§ˆè§†å›¾â€ï¼Œå¯ç”¨ `UICollectionView`ï¼›
* å½“â€æµè§ˆè§†å›¾â€œè¿›è¡Œâ€œä¸Šæ»‘â€æ“ä½œæ—¶ï¼Œæ— è®ºæ»‘åŠ¨å¤šä¹ˆå¿«é€Ÿéƒ½ä¸ä¼šè§¦å‘â€œé€‰ä¸­è§†å›¾â€çš„è¿å¸¦â€œä¸Šæ»‘â€æ“ä½œï¼›
* å½“ç”¨æˆ·ä»â€œæµè§ˆè§†å›¾â€çš„èŒƒå›´æ»‘åŠ¨åˆ°â€œé€‰ä¸­è§†å›¾â€ä¸­æ—¶ï¼Œä¹Ÿå°±æ˜¯æ‰‹æŒ‡è§¦æ‘¸åŒºåŸŸåˆ°è¾¾â€œé€‰ä¸­è§†å›¾â€åŒºåŸŸï¼Œå°†è§¦å‘â€œé€‰ä¸­è§†å›¾â€çš„è¿å¸¦â€œä¸Šæ»‘â€æ“ä½œã€‚
* å½“â€œé€‰ä¸­è§†å›¾â€å·²ç»åˆ°é¡¶æ—¶ï¼Œç”¨æˆ·ä»â€œæµè§ˆè§†å›¾â€è¿›è¡Œâ€ä¸‹æ‹‰â€œæ“ä½œï¼Œç›´æ¥è§¦å‘â€œé€‰ä¸­è§†å›¾â€çš„è¿å¸¦â€œä¸‹æ‹‰â€æ“ä½œã€‚

ä»¥ä¸Šæ˜¯ç›®å‰æ€»ç»“å‡º `Instagram` çš„â€œç…§ç‰‡æµè§ˆå™¨â€å››å¤§è¦ç‚¹ï¼Œåç»­çš„å¼€å‘å·¥ä½œä¹Ÿå›´ç»•ç€è¿™å››ç‚¹è¿›è¡Œã€‚


## éœ€æ±‚æ‹†åˆ†
åœ¨**æ€è€ƒ**ç¯èŠ‚æ˜ç¡®äº†è¯¥ç»„ä»¶çš„å¼€å‘éš¾ç‚¹åï¼Œå¼€å§‹å¯¹éœ€æ±‚è¿›è¡Œæ‹†åˆ†ï¼Œç»†è‡´å·¥ä½œé‡ã€‚å‰å‡ å¤©è¿˜å†’å‡ºäº†ä¸€ä¸ªâ€œç¬‘è¯â€ï¼Œç»„ä»¶éƒ½å¿«å¼€å‘å®Œäº†ï¼Œè‡ªå·±å´ä¸æ”¾å¿ƒï¼Œå¤šå˜´å†å»æ²Ÿé€šäº†ä¸€éï¼Œå‘ç°åŸæ¥æœ€ç»ˆçš„æ•ˆæœå’Œç›®å‰æ‰€å®ç°çš„å·®è·æœ‰äº›å¤§ï¼Œä¸å¾—ä¸åˆåå·¥é‡æ¥ã€‚

ç»è¿‡ä¸€ç•ªè°ƒç ”ï¼Œè®¾å®šçš„è€—æ—¶ä¸ºï¼š2å¤©ï¼ŒåŒ…æ‹¬å‰åç«¯è”è°ƒã€‚æ•´ç†å‡ºçš„éœ€æ±‚å¤§è‡´å¦‚ä¸‹ï¼š

Feature | UI | Power
--- | --- | --- 
æµè§ˆç›¸å†Œ | `UITableView` | 0.5
æµè§ˆç›¸å†Œç…§ç‰‡ | `UICollectionView` | 1
äº¤äº’ | - | 1


## å®ç°
ä¸€å¼€å§‹åœ¨æ•°æ®æºçš„è·å–ä¸Šå°±è·ªäº†ï¼Œä¹‹å‰åœ¨è¯»å–ç³»ç»Ÿç›¸å†Œèµ„æºè¿™æ–¹é¢éœ€æ±‚ä»…ä»…åªæ˜¯â€œè·å–â€è¿™ä¸€æ–¹é¢ï¼Œå¹¶æ²¡æœ‰å¯¹äº¤äº’æœ‰å¤ªå¤šçš„è¦æ±‚ï¼Œä¹Ÿå°±ä¸€ç›´æ²¡æœ‰ç²¾è¿›ï¼Œè¿™å›éœ€è¦å¯¹ç›¸å†Œåšä¸€ä¸ªè‡ªå®šä¹‰å°±è·ªåœ¨æ•°æ®æºçš„è·å–ä¸Šäº†ï¼Œæ„æ€åï¼Œè§‰å¾—æœ‰å¿…è¦æ‹‰å‡ºä¸€å±‚ `DataManager`ï¼Œè™½ç„¶åªæ˜¯ä»ç³»ç»Ÿä¸­æ‹‰æ•°æ®ï¼Œä½†ä¸ºäº†â€œé«˜å†…èšã€ä½è€¦åˆâ€çš„ç†å¿µï¼Œåº”è¯¥é™ä½â€œè°ƒç”¨æ–¹â€çš„ä½¿ç”¨æˆæœ¬ã€‚

æŒ‘å‡ºäº†ä¸€éƒ¨åˆ† `PhotosKit` æ¡†æ¶æ ¸å¿ƒçŸ¥è¯†ç‚¹åˆ—ä¸¾å¦‚ä¸‹ï¼š

* `PHObject`ï¼š`Photos` çš„èµ„æºé›†åˆå’Œé›†åˆåˆ—è¡¨çš„æŠ½è±¡çˆ¶ç±»ï¼›
* `PHAssetCollection`ï¼šä¸€ä¸ªç›¸å†Œï¼›
* `PHCollectionList`ï¼šä¸€ä¸ªåŒ…å«å¤šä¸ªç›¸å†Œçš„é›†åˆï¼›
* `PHFetchResult`ï¼š
  * ä½œä¸º `PHAsset`(Live Photo)ã€`PHCollection`ã€`PHAssetCollection`ã€`PHCollectionList` ç›¸å…³æ–¹æ³•çš„è¿”å›ç»“æœå¯¹è±¡ï¼›
  * å†…å®¹å¯åŠ¨æ€åŠ è½½ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŠŠæŸä¸ªç›¸å†Œä¸­çš„å†…å®¹ç›´æ¥å…¨éƒ¨éå†å‡ºæ¥ï¼Œè€Œæ˜¯å½“éœ€è¦ä¸€éƒ¨åˆ†å†…å®¹åæ‰ä¼šå»ç…§ç‰‡åº“ä¸­è·å–ï¼Œè¿™å¯ä»¥åœ¨å¤„ç†å¤§é‡ç»“æœæ—¶æä¾›ä¸€ä¸ªæœ€ä½³æ€§èƒ½ï¼›
  * é»˜è®¤**çº¿ç¨‹å®‰å…¨**ï¼›
  * ç¼“å­˜è§„åˆ™ä¸ªäººçœ‹æ³•æ˜¯åˆ©ç”¨äº† `LRU`ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹æœ‰å¾…è€ƒè¯ã€‚

### è¯»å–æ‰€æœ‰æ‰€éœ€ç›¸å†Œ
åŠ äº†ä¸ªå…³é”®è¯â€”â€”â€œæ‰€éœ€â€ï¼Œ`PhotosKit` æ¡†æ¶æä¾›äº†ä¸€å¥—ååˆ†å®Œæ•´çš„è·å–ä¸åŒç±»å‹ç›¸å†Œ APIï¼Œåœ¨ `PJAlbumDataManager` ä¸­ï¼Œæˆ‘æ˜¯è¿™ä¹ˆåšçš„ï¼š
```Swift
/// è·å–æ‰€æœ‰ç›¸å†Œ
private func allAlbumCollection() -> [PHAssetCollection] {
    var collections = [PHAssetCollection]()
    let smartAlbums = PHAssetCollection.fetchAssetCollections(with: .smartAlbum,
                                                              subtype: .any,
                                                              options: nil) as! PHFetchResult<PHCollection>
    let userAlbums = PHCollectionList.fetchTopLevelUserCollections(with: nil)
    
    for album in [smartAlbums, userAlbums] {
        for s_i in 0..<album.count {
            let collection = album[s_i] as! PHAssetCollection
            let types: [PHAssetCollectionSubtype] = [.albumRegular, // ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„ç›¸å†Œ
                                                      .smartAlbumPanoramas, // å…¨æ™¯
                                                      .smartAlbumScreenshots, // å±å¹•æˆªå›¾
                                                      .smartAlbumUserLibrary, // ç›¸æœºèƒ¶å·
                                                      .smartAlbumRecentlyAdded] // æœ€è¿‘æ·»åŠ 
            if types.contains(collection.assetCollectionSubtype) {
                collections.append(collection)
            }
        }
    }
    return collections
}
```

ä»ä¸Šæ–‡ä¸­åˆ—å‡ºæ¥çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæ˜ç¡®äº† `PHAssetCollection` ç›¸å½“äºæ˜¯ä¸€ä¸ªç›¸å†Œï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°ç”±ç›¸æœºæ‹æ‘„çš„ç…§ç‰‡é›† `.smartAlbum` å’Œç”¨æˆ·è‡ªå·±åˆ›å»ºçš„ç…§ç‰‡é›† `fetchTopLevelUserCollections`ï¼Œæ³¨æ„ï¼Œè¿™åŒ…æ‹¬äº†â€œè·å–ç›¸å†Œæƒé™â€çš„åº”ç”¨è‡ªè¡Œåˆ›å»ºçš„ç›¸å†Œã€‚

è€Œ `album` æ˜¯ `PHAssetResult<PHAssetCollection>` ç±»å‹ï¼Œä¸”å› æœªå®ç° `Sequence` åè®®ï¼Œè€Œæ— æ³•è¿›è¡Œéå†ï¼Œè€Œé‡‡å–äº†ä¸€ä¸ªç®€å•çš„åšæ³•ï¼Œè‡³äºæ¯”è¾ƒä¼˜é›…çš„åšæ³•æš‚æœªå®ç°ã€‚

### è·å–ç›¸å†Œå°é¢
é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†å½“å‰ç”¨æˆ·è®¾å¤‡ä¸­çš„æ‰€æœ‰æ‰€éœ€ç›¸å†Œé›†åˆã€‚é‚£å¦‚ä½•è·å–ä¸€ä¸ªç›¸å†Œçš„å°é¢ä»¥åŠå…¶æ‰€åŒ…å«çš„ç…§ç‰‡æ•°å‘¢ï¼Ÿç»è¿‡ä¸€ç•ªç ”ç©¶åå‘ç° `PHAssetCollection` ä¸­æä¾›äº†è·å–å¹¶æœªæä¾›â€œå°é¢â€è¿™ä¸ªå±æ€§ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰æä¾›å•ç‹¬çš„ API å»è·å–ä¸€ä¸ªç›¸å†Œå°é¢ï¼Œä½†æ˜¯é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒå°´å°¬çš„æ–¹æ³•ï¼Œå³é€šè¿‡è·å–ç›¸å†Œä¸­çš„æ‰€æœ‰ç…§ç‰‡ API å»é”å®šç¬¬ä¸€å¼ ç…§ç‰‡ï¼Œç›´æ¥ä½œä¸ºå°é¢ ğŸ˜…ï¼Œ`PJAlbumDataManager` ä¸­çš„å®ç°å¦‚ä¸‹ï¼š
```Swift
/// è·å–æ‰€æœ‰ç›¸å†Œå°é¢åŠç…§ç‰‡æ•°
func getAlbumCovers(complateHandler: @escaping (_ coverPhotos: [Photo], _ albumPhotosCounts: [Int]) -> Void) {
    let albumCollections = albums
    var photos = [Photo]()
    var photosCount = [Int]()
    // è·å–å•å¼ ç…§ç‰‡èµ„æºæ˜¯å¼‚æ­¥è¿‡ç¨‹ï¼Œéœ€è¦ç­‰å¾…æ‰€æœ‰ç›¸å†Œçš„å°é¢å›¾ç‰‡ä¸€èµ· append å®Œåå†ç»Ÿä¸€é€šè¿‡é€ƒé€¸é—­åŒ…è¿›è¡Œè¿”å›
    var c_index = 0
    for collection in albumCollections {
        let assets = albumPHAssets(collection)
        // æœ‰äº›ç³»ç»Ÿè‡ªå¸¦ç›¸å†Œç±»å‹å¦‚æœç”¨æˆ·æ²¡æœ‰è¿›è¡Œç…§ç‰‡å½’ç±»åˆ™ä¼šå¯¼è‡´å–åˆ°çš„ç›¸ç‰‡æ•°ä¸º0
        guard assets.count != 0 else {
            c_index += 1
            continue
        }
        
        photosCount.append(assets.count)
        
        var photo = Photo()
        photo.photoTitle = collection.localizedTitle
        convertPHAssetToUIImage(asset: assets[0],
                                size: CGSize(width: 150, height: 150),
                                mode: .fastFormat) { (photoImage) in
                                    photo.photoImage = photoImage
                                    photos.append(photo)
                                    c_index += 1
            
                                    if c_index == albumCollections.count - 1 {
                                        complateHandler(photos, photosCount)
                                    }
        }
    }
}
```

åŒæ ·åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬ä¹Ÿè¯´æ˜äº†ï¼Œä¸€å¼ å¼ çš„ç…§ç‰‡æ˜¯ `PHAsset` èµ„æºå¯¹è±¡ï¼Œè€Œ `PHAsset` æ˜¯ä» `PHAssetCollection` å–å‡ºçš„ï¼Œå¹¶ä¸”å–å‡ºçš„èµ„æºé›†åˆç±»å‹ä¸­ä¸éœ€è¦åŒ…å«è§†é¢‘ä¸”æŒ‰ç…§æ—¶é—´â€œç”±è¿‘åˆ°è¿œâ€å¯¹é›†åˆè¿›è¡Œæ’åºã€‚åœ¨ iOS ä¸­å¯¹é›†åˆè¿›è¡Œæ£€ç´¢æœ€ä½³åšæ³•æ˜¯é€šè¿‡**â€œè°“è¯â€**è¿›è¡Œé™åˆ¶ï¼Œ`PJAlbumDataManager` å®ç° `albumPHAssets` æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š
```Swift
/// å½“å‰ç›¸å†Œçš„æ‰€æœ‰ PJAsset
private func albumPHAssets(_ collection: PHAssetCollection) -> PHFetchResult<PHAsset> {
    let options = PHFetchOptions()
    options.predicate = NSPredicate(format: "mediaType = %d", PHAssetMediaType.image.rawValue)
    options.sortDescriptors = [NSSortDescriptor(key: "creationDate", ascending: false)]
    let fetchResult = PHAsset.fetchAssets(in: collection, options: options)
    return fetchResult
}
```

ä¸€ä¸ªç›¸å†Œä¸­çš„æ‰€æœ‰ `PHAsset` èµ„æºæ˜¯å…¨éƒ½æ‹¿åˆ°äº†ï¼Œä½†æ˜¯ `PHAsset` èµ„æºå´æ— æ³•ç›´æ¥ä¸ `UIKit` è¿›è¡Œåä½œï¼Œè¿˜éœ€è¦å¯¹ `PHAsset` å¯¹è±¡è½¬ä¸º `UIImage` å¯¹è±¡ï¼Œ`PJAlbumDataManager` ä¸­æ˜¯è¿™ä¹ˆåšçš„ï¼š
```Swift
/// PHAsset è½¬ UIImage
func convertPHAssetToUIImage(asset: PHAsset,
                                      size: CGSize,
                                      mode: PHImageRequestOptionsDeliveryMode,
                                      complateHandler: @escaping (_ photo: UIImage?) -> Void) {
    let coverSize = size
    let options = PHImageRequestOptions()
    options.isSynchronous = false
    options.deliveryMode = mode
    options.isNetworkAccessAllowed = true
    PHImageManager.default().requestImage(for: asset,
                                          targetSize: coverSize,
                                          contentMode: .default,
                                          options: options) { result, info in
                                            guard result != nil else { return complateHandler(nil) }
                                            complateHandler(result)
    }
}
```

åœ¨ `requestImage` æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æœ€ç»ˆè¦ç”Ÿæˆ `UIImage` å¯¹è±¡åšä¸€äº›é¢å¤–çš„è®¾ç½®ï¼Œä¾‹å¦‚â€œç›®æ ‡å°ºå¯¸â€ã€â€œæ˜¯å¦å¼‚æ­¥æ“ä½œâ€ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¼€å¯äº†â€œå¼‚æ­¥æ“ä½œâ€ï¼Œè¦è®°å¾—å¤„ç†å¥½å…¨éƒ¨ `PHAsset` èµ„æºé›†åˆçš„å¼‚æ­¥è·å–æ—¶é—´èŠ‚ç‚¹ï¼Œå¦åˆ™ä¸€å¼ ç…§ç‰‡éƒ½æ‹¿ä¸åˆ°ã€‚

#### UI æ­å»º
æ˜¾ç¤ºæ‰€æœ‰ç›¸å†Œçš„å°é¢åŠå…¶ç…§ç‰‡æ•°ï¼Œä¸Šæ–‡è§£å†³äº†æ•°æ®æ¥æºåï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±æ­£å¸¸æ“ä½œ `UITableView` å³å¯ï¼Œå®Œå·¥æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![é€‰æ‹©ç›¸å†Œ æˆªå›¾](https://i.loli.net/2018/12/21/5c1cc242ba1c8.png)


### è·å–ä¸€ä¸ªç›¸å†Œä¸‹çš„æ‰€æœ‰ç…§ç‰‡
è¿™éƒ¨åˆ†æ€è·¯å·²ç»ä¸ŠèŠ‚ä¸­æè¿°è¿‡äº†ï¼ŒæŠŠâ€œåªå–ç¬¬ä¸€å¼ çš„ç…§ç‰‡â€é™åˆ¶æ¡ä»¶æ”¾å¼€å³å¯ï¼Œ`PJAlbumDataManager` çš„å®ç°å¦‚ä¸‹ï¼š
```Swift
/// è·å–æŸä¸€ç›¸å†Œçš„æ‰€æœ‰ç…§ç‰‡
func getAlbumPhotos(albumCollection: PHAssetCollection,
                    complateHandler: @escaping (([Photo], PHFetchResult<PHAsset>) -> Void)) {
    let assets = albumPHAssets(albumCollection)
    var photos = [Photo]()

    for a_index in 0..<assets.count {
        var photo = Photo()
        convertPHAssetToUIImage(asset: assets[a_index],
                                size: CGSize(width: 150, height: 150),
                                mode: .highQualityFormat) { (photoImage) in
                                    photo.photoImage = photoImage
                                    photo.photoTitle = albumCollection.localizedTitle ?? ""
                                    photos.append(photo)
            
                                    if a_index == assets.count - 1 {
                                        complateHandler(photos, assets)
                                    }
        }
    }
}
```

#### UI æ­å»º
åœ¨ç›¸å†Œè¯¦æƒ…çš„ UI æ­å»ºä¸­ï¼Œä¸»è¦æ¶‰åŠåˆ°æœ‰ `UICollectionView` å’Œ `UIImageView` ä¸¤è€…ï¼Œä½†åœ¨äº¤äº’ä¸Šéœ€è¦æ»¡è¶³ä¸Šæ–‡æ‰€è¯´çš„è¿™ä¸‰ç‚¹ï¼š
* å½“â€æµè§ˆè§†å›¾â€œè¿›è¡Œâ€œä¸Šæ»‘â€æ“ä½œæ—¶ï¼Œæ— è®ºæ»‘åŠ¨å¤šä¹ˆå¿«é€Ÿéƒ½ä¸ä¼šè§¦å‘â€œé€‰ä¸­è§†å›¾â€çš„è¿å¸¦â€œä¸Šæ»‘â€æ“ä½œï¼›
* å½“ç”¨æˆ·ä»â€œæµè§ˆè§†å›¾â€çš„èŒƒå›´æ»‘åŠ¨åˆ°â€œé€‰ä¸­è§†å›¾â€ä¸­æ—¶ï¼Œä¹Ÿå°±æ˜¯æ‰‹æŒ‡è§¦æ‘¸åŒºåŸŸåˆ°è¾¾â€œé€‰ä¸­è§†å›¾â€åŒºåŸŸï¼Œå°†è§¦å‘â€œé€‰ä¸­è§†å›¾â€çš„è¿å¸¦â€œä¸Šæ»‘â€æ“ä½œã€‚
* å½“â€œé€‰ä¸­è§†å›¾â€å·²ç»åˆ°é¡¶æ—¶ï¼Œç”¨æˆ·ä»â€œæµè§ˆè§†å›¾â€è¿›è¡Œâ€ä¸‹æ‹‰â€œæ“ä½œï¼Œç›´æ¥è§¦å‘â€œé€‰ä¸­è§†å›¾â€çš„è¿å¸¦â€œä¸‹æ‹‰â€æ“ä½œã€‚

è¿™ä¸‰ç‚¹ä¸­å®ç°éš¾åº¦ç›¸å¯¹è¾ƒé«˜çš„ä¸ºç¬¬äºŒç‚¹ï¼Œéœ€è¦åˆ©ç”¨ `hitTest` æˆ– `point(inside)` è¿›è¡Œå®ç°ï¼Œè¿™éƒ¨åˆ†æ”¾åˆ°ä¸‹ç¯‡æ–‡ç« ä¸­ç»“åˆå‰åç«¯äº¤äº’ä¸€å—è¿›è¡Œåˆ†äº«ã€‚ç›®å‰å®ç°çš„éƒ¨åˆ†æ•ˆæœæˆªå›¾å¦‚ä¸‹ï¼š

![ç›¸å†Œè¯¦æƒ… æˆªå›¾](https://i.loli.net/2018/12/21/5c1cc74f41c52.png)


## ä¼˜åŒ–ç‚¹
* ç›¸å†Œè¯»å–å› ä¸ºé‡‡ç”¨çš„æ˜¯â€œè®¡ç®—å±æ€§â€ï¼Œå¹¶ä¸ä¼šå¯¹å·²ç»è¯»å–è¿‡çš„æ•°æ®ç»“æœè¿›è¡Œç¼“å­˜ï¼Œåº”é‡‡ç”¨ `lazy`ï¼›
* äº¤äº’ç»†èŠ‚éœ€è¦ç»§ç»­å®Œå–„ã€‚